# React Query in `shipwell/frontend-web`

---

## What we will cover

<StepTransition>

- What is React Query?
- Query basics
- Mutation basics
- What _isn't_ React Query?
- How React Query fits into `shipwell/frontend-web`

</StepTransition>

---

## What is React Query?

![react query](./assets/react-query.svg)

From <https://react-query.tanstack.com/overview>:

<Block sx={{
  width: '50%'
}}>

> React Query is often described as the missing data-fetching library for React, but in more technical terms, it makes fetching, caching, synchronizing and updating server state in your React applications a breeze.

</Block>

---

## But what does that mean?

<Step styles={{
  before: {display: 'none'},
  current: {display: '', transition: 'all 0.2s ease-out'},
  after: {display: 'none'}
}}
>

<Block>

It replaces this

```js file=./before.js

```

</Block>

<Block>

With this

```js file=./after.js

```

</Block>

</Step>

---

## React Query

<StepTransition>

- Reduces boilerplate around API calls,
- Manages caching for us so we don't have to reach for Redux,
- Provides loading, error, and success states,
- And does _a lot_ more that we probably won't get to cover here.

</StepTransition>

<Note>

Remember that React Query is new to me, too, and I'm still learning it.
There's a lot that it offers that can help us, and I'm learning more about it as we use it in the Drayage project

</Note>

---

## Query Basics

### Query keys

<StepTransition>

<Block>

From <https://react-query.tanstack.com/guides/query-keys>:

> At its core, React Query manages query caching for you based on query keys. Query keys can be as simple as a string, or as complex as an array of many strings and nested objects. As long as the query key is serializable, and **unique to the query's data**, you can use it!

</Block>

Query keys are important because they uniquely describe the data being fetched, and that is what is used for efficient caching and refetching of data.

</StepTransition>

---

## Query Basics

### Query keys

#### If your query function depends on a variable, include it in your query key

Since query keys uniquely describe the data they are fetching, they should include any variables you use in your query function that change. For example:

```js
function Todos({todoId}) {
  const result = useQuery(['todos', todoId], () => fetchTodoById(todoId));
}
```

From <https://react-query.tanstack.com/guides/query-keys>:

It's useful to think of these array keys as analogous to the dependencies in a `useEffect` dependency array.

<Note>

Most of our queries involve some kind of id, so most array keys will include at least two elements: the descriptor of the query and the id it depends on.

</Note>

---

## What does React Query _not_ do or change?

<StepTransition>

<StepTransition>

- Our API wrappers remain exactly the same: more on _query functions_ later.
- Any truly local/client state management is not covered by React Query
  - We don't have much (or any) of this, but e.g. layout state or current theme
- React Query cannot replace _all_ API/async fetching calls in our app.
  - Components that need an async way to load data, e.g. async react-select.

</StepTransition>

<StepTransition>

```js file=./react-select-example.js

```

</StepTransition>

</StepTransition>
